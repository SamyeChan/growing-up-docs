# ã€ç»„ä»¶çš„å•å…ƒæµ‹è¯•ã€‘

## å‰ç½®

å½“ç»„ä»¶æŠ½å‡ºæ¥åˆæœ‰äº›åˆç†éœ€æ±‚æ–°å¢ï¼Œé‚£å°±å¾—å¯¹å°è£…çš„ç»„ä»¶ä¸‹æ‰‹äº†ï¼Œä¸€ä¸‹ä¸çŸ¥è½»é‡ï¼Œå¯èƒ½å°±ä¼šæŠŠåŸæœ¬å¥½å¥½çš„åŠŸèƒ½æåï¼Œæ€ä¹ˆå¯ä»¥è®©è¿™ç§äº‹æƒ…å‘ç”Ÿå‘¢ï¼Œäºæ˜¯ä¹ï¼Œå•å…ƒæµ‹è¯•ï¼Œä¸Šå–ï¼

### ç¢ç¢å¿µ

å…¶å®ä¹‹å‰è€å¤§å°±è®©æˆ‘å†™ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹äº†ï¼Œå¯æˆ‘å±…ç„¶æ‹–å»¶äº†...å¯èƒ½å°±æ˜¯å¯¹è‡ªå·±å°è£…çš„ä»£ç æå…¶ä¸è‡ªä¿¡å§ï¼Œä¸€ç›´åœ¨ä¿®ä¿®è¡¥è¡¥ï¼Œä½†ä¿®ä¿®è¡¥è¡¥çš„è¿‡ç¨‹ä¸­ï¼Œå°±å‘ç”Ÿç‚¹å°æ’æ›²äº†ï¼Œå½“ç„¶ï¼Œæ˜¯åœ¨æœ¬åœ°è‡ªæµ‹çš„æ—¶å€™ï¼Œemmmï¼Œæ˜¯åº”è¯¥å¥½å¥½æå•å…ƒæµ‹è¯•ï¼Œç•™ä¸‹è¯æ®å’Œ Plan Bï¼Œè®©è‡ªå·±ä»¥åå®‰å¿ƒä¿®è¡¥å–~~~

æŒ‰ç…§è€å¤§ç»™çš„æŒ‡è·¯ï¼Œæ˜¯å®ƒæ˜¯å®ƒå°±æ˜¯å®ƒ â†’ jestï¼Œç„¶åæˆ‘æ ¹æ®ç»™çš„ demoï¼Œå¼€å§‹äº†æœ€ç®€å•çš„å¿«ç…§æµ‹è¯•ï¼Œç­‰äºå°±æ˜¯ä¼ å‚ï¼Œç„¶åå¤‡ä»½ä¸€ä¸ª DOM ç»“æ„ï¼Œç„¶åå°±å¼€å§‹ç… ğŸ‘‰ [å®˜æ–¹æ–‡æ¡£](https://www.jestjs.cn/docs/getting-started)

å“‡ï¼Œæˆ‘èƒ½è¯´æ™¦æ¶©éš¾æ‡‚å˜›...è€Œä¸”ï¼Œæˆ‘å‘ç°æˆ‘éƒ½æ²¡ææ‡‚è€å¤§è¯´çš„æ„æ€ï¼Œemm...å…¶å®æ˜¯ç›´æ¥ä¸Šæ‰‹ `Vue Test Utils`å•¦...

### å•å…ƒæµ‹è¯•ä¸‰æ­¥éª¤

1. å®‰æ’ï¼ˆArrangeï¼‰ï¼šä¸ºæµ‹è¯•åšå¥½è®¾ç½®ï¼›
2. è¡ŒåŠ¨ï¼ˆActï¼‰ï¼šå¯¹ç³»ç»Ÿæ‰§è¡Œæ“ä½œï¼›
3. æ–­è¨€ï¼ˆAssertï¼‰ï¼šç¡®ä¿çœŸå®çš„ç»“æœåŒ¹é…ä½ çš„æœŸæœ›ï¼Œéœ€è¦æ–­è¨€ä»¥ç¡®ä¿ç»„ä»¶è¿è¡Œæ­£ç¡®ï¼›

   [æ–­è¨€å°±æ˜¯æ¯”è¾ƒï¼Œåˆ¤æ–­æ­£ä¸æ­£ç¡®ï¼Œ1+1 æ˜¯ä¸æ˜¯ç­‰äº 2ï¼Œå°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„æ–­è¨€]

## What | è¯¥æµ‹ä»€ä¹ˆï¼Ÿ

å…³äºè¯¥æµ‹ä»€ä¹ˆï¼Œæˆ‘è‡ªå·±çš„è®¤ä¸ºæ˜¯ï¼Œç»„ä»¶æ”¯æŒä»€ä¹ˆå°±æµ‹ä»€ä¹ˆï¼Œç„¶åå‚è€ƒäº†ä¸€ç¯‡æ–‡ï¼Œå¾—åˆ°æ›´ç»†è‡´çš„ What~

ğŸ‘‰ [Vue ç»„ä»¶å•å…ƒæµ‹è¯•ç©¶ç«Ÿæµ‹è¯•ä»€ä¹ˆï¼Ÿ](https://juejin.cn/post/6844904057094537229)

- ç»„ä»¶å•å…ƒæµ‹è¯•çš„ä¸€ä¸ªå¥½ç†å¿µæ˜¯`å…ˆå‡è®¾æµ‹è¯•æ˜¯ä¸å¿…è¦çš„ï¼Œé™¤éè¢«è¯æ˜æ˜¯å¿…è¦çš„`ï¼›
- ä½ å¯ä»¥é—®è‡ªå·±ä»¥ä¸‹é—®é¢˜ï¼š
  1. è¿™æ˜¯ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†å—ï¼Ÿ
  2. è¿™æ˜¯ç›´æ¥æµ‹è¯•ç»„ä»¶çš„è¾“å…¥å’Œè¾“å‡ºå—ï¼Ÿ
  3. è¿™æ˜¯æµ‹è¯•è‡ªå·±çš„ä»£ç ï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»£ç ï¼Ÿ

## How | æ€ä¹ˆæµ‹ï¼Ÿ

- æ ¹æ®ä¸Šè¿°çš„æ–‡ç« ï¼ŒHow è¿™ä¸€å…³ï¼Œå¤§æ¦‚éœ€è¦è€ƒè™‘å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

  1. é…ç½® Spec æ–‡ä»¶ï¼›
  2. ç¡®å®šä¸šåŠ¡é€»è¾‘ï¼›
  3. ç¡®å®šè¾“å…¥ã€è¾“å‡ºï¼›
  4. ä¸è¿‡åº¦æµ‹è¯•ï¼›

- æ‰§è¡Œæµç¨‹ï¼š è¾“å…¥ - é¢„æœŸè¾“å‡º - æ–­è¨€ç»“æœï¼›

- ä»¥ `vc-admin` ä¸­çš„ `Infobar` ç»„ä»¶ä½œä¸ºæ —å­ï¼š

  ![vc-infobar](./static/demo-infobar-01.png)

  - è¿™æ˜¯ä¸€ä¸ªé¡¹ç›®åå°ç®¡ç†é¡µé¢ä¸­å›ºå®šå¸ƒå±€çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ä½œä¸ºä¸€ä¸ª UI ç»„ä»¶ï¼›
  - å±•ç¤ºé¡µé¢æ ‡é¢˜ã€æè¿°ï¼Œæä¾›è¿”å›ä¸Šä¸€é¡µã€è‡ªå®šä¹‰å³ä¾§ slot æ’å…¥ï¼›

### é…ç½® Spec æ–‡ä»¶

```bash
vue add unit-jest
```

- é»˜è®¤æƒ…å†µä¸‹ï¼ŒJest å°†ä¼šé€’å½’çš„æ‰¾åˆ°æ•´ä¸ªå·¥ç¨‹é‡Œæ‰€æœ‰ `.spec.js` æˆ– `.test.js` æ‰©å±•åçš„æ–‡ä»¶ï¼›
- Jest æ¨èåœ¨è¢«æµ‹è¯•ä»£ç çš„æ‰€åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `__tests__` ç›®å½•ï¼›

### ç¡®å®šä¸šåŠ¡é€»è¾‘

1. ç»„ä»¶æ¥æ”¶å‚æ•°å¹¶æ¸²æŸ“ï¼›
2. ç»„ä»¶æä¾›è¿”å›ä¸Šä¸€é¡µæŒ‰é’®ï¼›
3. ç»„ä»¶å¯è‡ªå®šä¹‰å³ä¾§ slot æ’å…¥ï¼›

### ç¡®å®šè¾“å…¥ã€è¾“å‡º

- è¾“å…¥ï¼š

  1. props: title/description/isBackï¼›
  2. slot æ•°æ®ä¼ å…¥ï¼›
  3. ç”¨æˆ·ç‚¹å‡»è¿”å›ä¸Šä¸€é¡µæŒ‰é’®ï¼›

- è¾“å‡ºï¼š

  1. æ¸²æŸ“åçš„ HTMLï¼›
  2. ç¡®è®¤ä¼ å…¥ props æ•°æ®æ˜¯å¦æ¸²æŸ“ï¼›
  3. slot ç»“æ„æ˜¯å¦æ¸²æŸ“ï¼›
  4. ç”¨æˆ·ç‚¹å‡»æ˜¯å¦å“åº”ï¼›

### ä¸è¿‡åº¦æµ‹è¯•

åœ¨æ —å­ä¸­ï¼Œç‚¹å‡»è¿”å›ä¸Šä¸€é¡µæŒ‰é’®ï¼Œè¯¥è¾“å‡ºä¾èµ–è·¯ç”±åŠŸèƒ½ï¼Œä½†å¹¶ä¸åº”è¯¥æ˜¯ç»„ä»¶æ‰€å…³å¿ƒçš„ï¼Œåœ¨æ­¤å¤„æ¨¡æ‹Ÿäº†è·¯ç”±ç›¸å…³è®¾ç½®ï¼š

```js
const mockRoute = {
  $route: {
    meta: {
      title: 'è·¯ç”±æ ‡é¢˜'
    }
  },
  $router: {
    go: clickHandler
  }
}
```

### æµ‹è¯•ä»£ç 

1. ä¸é…ç½®æ•°æ®ï¼Œæ ‡é¢˜å–è‡ªè·¯ç”±ï¼š

```js
test('01 ä¸é…ç½®æ•°æ®ï¼Œæ ‡é¢˜å–è‡ªè·¯ç”±', () => {
  const wrapper = shallowMount(Infobar, {
    mocks: mockRoute
  })

  expect(wrapper.html()).toMatchSnapshot()
})
```

2. ç”¨æˆ·ç‚¹å‡»æ˜¯å¦å“åº”

```js
test('04 æ ‡é¢˜+æè¿°+è¿”å›æŒ‰é’®bar', async () => {
  const wrapper = mount(Infobar, {
    propsData: Infobar04,
    mocks: mockRoute
  })

  const backEl = wrapper.find('.back')

  await backEl.trigger('click')

  // æ˜¯å¦æ¸²æŸ“å‡ºè¿”å›æŒ‰é’®
  expect(backEl.exists()).toBe(true)
  // è¿”å›æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»
  expect(clickHandler.called).toBe(true)
  expect(wrapper.html()).toMatchSnapshot()
})
```

3. slot ç»“æ„æ˜¯å¦æ¸²æŸ“

```js
test('05 æ ‡é¢˜+æè¿°+è¿”å›æŒ‰é’®+slot[right]bar', () => {
  const wrapper = shallowMount(Infobar, {
    propsData: Infobar04,
    mocks: mockRoute,
    slots: {
      right: '<div>å³ä¾§slotæ’å…¥æ²¡</div>'
    }
  })

  // å³ä¾§slotæ˜¯å¦æ’å…¥å¯¹åº”å…ƒç´ 
  expect(wrapper.find('div.right').exists()).toBe(true)
  expect(wrapper.html()).toMatchSnapshot()
})
```

ğŸ‘‰ [Vue Test Utils](https://vue-test-utils.vuejs.org/zh/)

ğŸ‘‰ [Vue æµ‹è¯•æŒ‡å—](https://lmiller1990.github.io/vue-testing-handbook/zh-CN/)

ğŸ‘‰ [Jest å•å…ƒæµ‹è¯•å…¥é—¨](https://www.cnblogs.com/SamWeb/p/11454923.html)

ğŸ‘‰ [å•å…ƒæµ‹è¯•è§„èŒƒ](https://juejin.cn/post/6844903844401381390)
